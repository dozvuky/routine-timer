<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë£¨í‹´ íƒ€ì´ë¨¸ ìœ„ì ¯</title>
    <style>
        /* CSS ì‹œì‘ */
        .routine-widget {
          width: 300px;
          padding: 20px;
          background-color: #e9f7ef;
          border-radius: 15px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          text-align: center;
          font-family: 'Noto Sans KR', sans-serif;
        }

        #currentTaskTitle {
          font-size: 1.5em;
          color: #2c3e50;
          margin-bottom: 10px;
        }

        .timer-display {
          font-size: 4em;
          font-weight: bold;
          color: #3498db;
          margin-bottom: 20px;
        }

        .controls {
          display: flex;
          justify-content: space-around;
          margin-bottom: 15px;
        }

        .control-btn {
          padding: 10px 15px;
          border: none;
          border-radius: 8px;
          font-size: 1em;
          cursor: pointer;
          font-weight: 500;
          transition: background-color 0.2s;
        }

        #startStopBtn {
          background-color: #2ecc71;
          color: white;
        }

        #checkBtn {
          background-color: #3498db;
          color: white;
        }

        .next-task {
          font-size: 0.9em;
          color: #7f8c8d;
        }
        /* CSS ë */
    </style>
</head>
<body>

    <div class="routine-widget">
        <h2 id="currentTaskTitle">ëª¨ë‹ ë£¨í‹´ ì¤€ë¹„</h2>
        <div class="timer-display" id="display">00:00</div>
        <div class="controls">
            <button class="control-btn" id="startStopBtn">ì‹œì‘</button>
            <button class="control-btn check-btn" id="checkBtn">ì™„ë£Œ (ë‹¤ìŒ ë£¨í‹´)</button>
        </div>
        <p class="next-task" id="nextTaskInfo">ë‹¤ìŒ: ë£¨í‹´ ëª©ë¡ì„ ë¡œë”© ì¤‘...</p>
    </div>
    <script>
        // JS ì‹œì‘
        // ==========================================================
        // ğŸš¨ Google Sheet ID ì„¤ì • ğŸš¨
        // ==========================================================
        const SHEET_ID = '1qldoMY1EZzjbREa26MdLuW7GH_t5OkqvP5Bysd62hRo'; 
        const SHEET_NAME = 'Sheet1'; 

        const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

        // ==========================================================
        // ğŸ’¡ DOM ìš”ì†Œ ë° ìƒíƒœ ë³€ìˆ˜
        // ==========================================================
        const display = document.getElementById('display');
        const startStopBtn = document.getElementById('startStopBtn');
        const checkBtn = document.getElementById('checkBtn');
        const currentTaskTitle = document.getElementById('currentTaskTitle');
        const nextTaskInfo = document.getElementById('nextTaskInfo');

        let routineList = []; 
        let currentTaskIndex = 0;
        let timer;
        let isRunning = false;
        let remainingTime;


        // ==========================================================
        // ğŸ’¡ ë°ì´í„° ë¡œë“œ ë° ì´ˆê¸°í™” í•¨ìˆ˜
        // ==========================================================
        async function loadRoutineData() {
            try {
                const response = await fetch(URL);
                const data = await response.text();
                
                // JSON ì‘ë‹µ íŒŒì‹±
                const jsonText = data.substring(data.indexOf('(') + 1, data.lastIndexOf(')'));
                const json = JSON.parse(jsonText);
                const rows = json.table.rows;
                
                routineList = rows.map(row => ({
                    name: row.c[0].v, // Aì—´ (í•  ì¼ ì´ë¦„)
                    duration: row.c[1].v * 60 // Bì—´ (ë¶„ ë‹¨ìœ„ -> ì´ˆ ë‹¨ìœ„ë¡œ ë³€í™˜)
                })).filter(task => task.name && task.duration > 0); 

                console.log("ë£¨í‹´ ë°ì´í„° ë¡œë“œ ì„±ê³µ:", routineList);
                initializeTask(); // ë°ì´í„° ë¡œë“œ í›„ ì´ˆê¸° ì‘ì—… ì‹œì‘
                
            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨. ì‹œíŠ¸ IDì™€ ê³µê°œ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.", error);
                currentTaskTitle.textContent = "ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨!";
                nextTaskInfo.textContent = "ì‹œíŠ¸ ì„¤ì • í™•ì¸ í•„ìš”.";
            }
        }

        function initializeTask() {
            if (currentTaskIndex < routineList.length) {
                const task = routineList[currentTaskIndex];
                currentTaskTitle.textContent = task.name;
                remainingTime = task.duration;
                display.textContent = formatTime(remainingTime);
                updateNextTaskInfo();
                startStopBtn.disabled = false;
                checkBtn.disabled = false;
            } else {
                currentTaskTitle.textContent = "ë£¨í‹´ ì™„ë£Œ!";
                display.textContent = "DONE";
                startStopBtn.disabled = true;
                checkBtn.disabled = true;
                nextTaskInfo.textContent = 'ëª¨ë“  ë£¨í‹´ ì™„ë£Œ!';
            }
        }

        // ==========================================================
        // ğŸ’¡ íƒ€ì´ë¨¸ ì‘ë™ ë° ì œì–´ í•¨ìˆ˜
        // ==========================================================

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes < 10 ? '0' : ''}${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function updateNextTaskInfo() {
            if (currentTaskIndex + 1 < routineList.length) {
                const nextTask = routineList[currentTaskIndex + 1];
                nextTaskInfo.textContent = `ë‹¤ìŒ í•  ì¼: ${nextTask.name} (${Math.floor(nextTask.duration / 60)}ë¶„)`;
            } else {
                nextTaskInfo.textContent = 'ëª¨ë“  ë£¨í‹´ ì™„ë£Œ!';
            }
        }

        function startStopTimer() {
            if (isRunning) {
                clearInterval(timer);
                isRunning = false;
                startStopBtn.textContent = 'ì¬ê°œ';
            } else if (remainingTime > 0) {
                isRunning = true;
                startStopBtn.textContent = 'ì •ì§€';

                timer = setInterval(() => {
                    remainingTime--;
                    display.textContent = formatTime(remainingTime);

                    if (remainingTime <= 0) {
                        clearInterval(timer);
                        isRunning = false;
                        alert(`${routineList[currentTaskIndex].name} ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`);
                        startStopBtn.textContent = 'ì‹œì‘';
                    }
                }, 1000);
            }
        }

        function moveToNextTask() {
            clearInterval(timer);
            isRunning = false;
            startStopBtn.textContent = 'ì‹œì‘';
            
            currentTaskIndex++;
            
            initializeTask();
        }


        // ==========================================================
        // ğŸ’¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë° ì‹œì‘
        // ==========================================================

        startStopBtn.addEventListener('click', startStopTimer);
        checkBtn.addEventListener('click', moveToNextTask);

        // ìœ„ì ¯ ì´ˆê¸°í™” ëŒ€ì‹  ë°ì´í„° ë¡œë“œ ì‹œì‘
        loadRoutineData(); 
        // JS ë
    </script>
</body>
</html>
